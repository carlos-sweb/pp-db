<!DOCTYPE html>
<html lang="en" style="height:100%;">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"  />
  <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.5/build/pure-min.css" >

  <title>Document</title>
</head>
<body style="background-color:#F5F5F5;height:100%!important;min-height:100%!important;">

<div class="pure-g" >
    <div class="pure-u-1-4" >
    		<h3>Base de datos</h3>
    		<ul id="databases"></ul>
    </div>
    <div class="pure-u-3-4">
		<br>
	    	<a href="#/section/database" class="pure-button">Database</a>
	    	<a href="#/section/sql" class="pure-button">SQL</a>
    	<hr>
    	<br>
		<form class="pure-form" onsubmit="createDB(event);event.preventDefault();" >
			
			<fieldset>
			<legend>Create DB</legend>
				<input type="text" name="dbname" id="dbname" placeholder="Name" required />
				<input name="version" id="version" min="1" type="number" placeholder="version" value="1" required />
				<button type="submit" class="pure-button pure-button-primary">ADD</button>
			</fieldset>

			<fieldset>
			<legend>Stores</legend>
				<input type="text" name="stores" placeholder="Name" required />
				<!--<input name="version" id="version" min="1" type="number" placeholder="version" value="1" required />!-->
				<a class="pure-button" style="background-color:#4CAF50;color:black;">Agregar</a>
			</fieldset>

			<fieldset>
				<input type="text" name="stores" placeholder="Name" required />			
				<!--<input type="text" name="dbname" id="dbname" placeholder="Name" required />
				<input name="version" id="version" min="1" type="number" placeholder="version" value="1" required />-->
				<a onclick="deleteStore(event)" class="pure-button" style="background-color:#D32F2F;color:white;">Eliminar</a>
			</fieldset>

		</form>

    </div>    
</div>

 
<script src="db.js"></script>
<script type="text/javascript">







var databases = [];

var _db = new ppDB();

/*
_db.open('pharmacy',1,{},{
	error:function(event){
		alert("Database error: " + event.target.errorCode);
	},
	success:function( db ){
		



		console.log("Estamos listos SUCCESS");

	},
	upgradeneeded:function(db){

		db.createObjectStore("task");
		console.log("Estamos listos upgradeneeded");

	}
});
*/

function showListDb( data){

	var c = document.getElementById('databases');
	var string = "";
	data.forEach((d)=>{
	string += "<li><a href='#/"+d.name+"'>"+d.name+"&nbsp;(&nbsp;v-"+d.version+"&nbsp;)</a>&nbsp;&nbsp;<button class='pure-button' onclick='deleteDB(\""+d.name+"\")' >Eliminar</button></li>";
	});

	setTimeout(()=>{
	c.innerHTML = string;
	},800);

}

indexedDB.databases().then(showListDb);
//----------------------------------------------------------------------------
function createDB( event ){		

	const dbname = event.target.querySelector("input[id=dbname]").value;

	const version = event.target.querySelector("input[id=version]").value;


	var stores = Array.from(event.target.querySelectorAll("input[name=stores]")).map(function(elem){
		const obj = new Object();
		obj[elem.value] = {};
		return obj;
	});



	_db.open(dbname,version,{
		"task":{keyPath:"id",autoIncrement:true},
		"customer":{keyPath:"id",autoIncrement:true}
	},{
		success:function(){			
			indexedDB.databases().then(showListDb);
		}
	});

	event.target.reset();

}
//----------------------------------------------------------------------------

function deleteDB( dbname ){
	_db.delete(dbname, function(){
		indexedDB.databases().then(showListDb);
	});
}


function deleteStore(event){
	event.target.parentElement.remove()	
}


</script>

</body>
</html>
